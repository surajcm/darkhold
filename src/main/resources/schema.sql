-- Drop tables in reverse dependency order
drop table if exists current_game_session;
drop table if exists game;
drop table if exists question_set;
drop table if exists challenge;
drop table if exists member_roles;
drop table if exists roles;
drop table if exists member;

-- Create tables
create table member (
    id          bigint generated by default as identity (start with 13) primary key,
    firstname   varchar(225),
    lastname    varchar(225),
    email       varchar(225) unique,
    password    varchar(255),
    photo       varchar(45),
    enabled     boolean default false not null,
    createdOn   timestamp,
    modifiedOn  timestamp,
    createdBy   varchar(45),
    modifiedBy  varchar(45)
);

create table roles (
   id          bigint generated by default as identity (start with 1) primary key,
   name        varchar(225),
   description varchar(225),
   createdOn   timestamp,
   modifiedOn  timestamp,
   createdBy   varchar(45),
   modifiedBy  varchar(45)
);

create table member_roles (
      users_id   bigint,
      roles_id   bigint
);

create table challenge (
       challenge_id bigint generated by default as identity (start with 2) primary key,
       title        varchar(225),
       description  varchar(225),
       challengeowner bigint,
       createdOn    timestamp,
       modifiedOn   timestamp,
       createdBy    varchar(45),
       modifiedBy   varchar(45)
);

alter table challenge add foreign key (challengeowner) REFERENCES member (id);

create table question_set (
      id             bigint generated by default as identity (start with 5) primary key,
      question       varchar(425),
      answer1        varchar(225),
      answer2        varchar(225),
      answer3        varchar(225),
      answer4        varchar(225),
      correctOptions varchar(225),
      display_order  int default 0,
      challenge_id   bigint
);

create table game (
      game_id     bigint generated by default as identity (start with 1) primary key,
      pin         varchar(225),
      gameStatus  varchar(225),
      challengeId varchar(225),
      createdOn   timestamp,
      modifiedOn  timestamp
);

create table current_game_session (
      id                      bigint generated by default as identity (start with 1) primary key,
      pin                     varchar(225) not null unique,
      moderator               varchar(225) not null,
      users_json              text,
      questions_json          text,
      current_question_no     int,
      scores_json             text,
      streak_json             text,
      previous_scores_json    text,
      teams_json              text,
      player_teams_json       text,
      team_assignment_method  varchar(20),
      game_status             varchar(20) default 'WAITING',
      game_mode               varchar(20) default 'MULTIPLAYER',
      paused_at               bigint
);





